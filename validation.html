<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation Dashboard - Healthcare Audit Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        body {
            background-color: #121212 !important;
            color: #e0e0e0 !important;
        }
        .main-content {
            background-color: #121212 !important;
        }
        .card {
            background-color: #1e1e1e !important;
            border: 1px solid #333 !important;
        }
        .card .card-header, .card .card-body, .card .card-footer, .list-group-item {
            background-color: transparent !important;
            color: #e0e0e0 !important;
            border-color: #333 !important;
        }
        h1, h2, h3, h4, h5, h6, p, span, div, strong, th, td, .text-sm, .text-xs {
            color: #e0e0e0 !important;
        }
        .font-weight-bolder, .text-dark {
            color: #ffffff !important;
        }
        .text-uppercase, .text-secondary {
            color: #b0b0b0 !important;
        }
        .table {
            color: #e0e0e0 !important;
        }
        .table thead th {
             border-bottom: 1px solid #444 !important;
        }
        .table tbody tr:hover td {
            background-color: #2a2a2a !important;
        }
        /* Force dark theme for all table elements */
        .table {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
        }
        .table thead {
            background-color: #1e1e1e !important;
        }
        .table tbody {
            background-color: #1e1e1e !important;
        }
        .table tbody tr {
            background-color: #1e1e1e !important;
        }
        .table tbody tr:nth-child(even) {
            background-color: #252525 !important;
        }
        .table tbody tr:nth-child(odd) {
            background-color: #1e1e1e !important;
        }
        .table tbody tr:hover {
            background-color: #2a2a2a !important;
        }
        .table tbody tr:hover td {
            background-color: #2a2a2a !important;
        }
        /* Override Bootstrap's default table hover */
        .table-hover tbody tr:hover {
            background-color: #2a2a2a !important;
        }
        .table-hover tbody tr:hover > td {
            background-color: #2a2a2a !important;
        }
        .table-hover tbody tr:hover > th {
            background-color: #2a2a2a !important;
        }
        /* Completely override Bootstrap table defaults */
        .table,
        .table > :not(caption) > * > * {
            background-color: #1e1e1e !important;
            border-color: #333 !important;
        }
        .table > :not(caption) > * > * {
            padding: 0.75rem !important;
            border-bottom-width: 1px !important;
            border-bottom-color: #333 !important;
        }
        /* Ensure no white backgrounds anywhere */
        .table-responsive {
            background-color: #1e1e1e !important;
        }
        .card-body .table-responsive {
            background-color: transparent !important;
        }
        /* Fix icon circles in statistics cards */
        .icon-shape {
            width: 48px !important;
            height: 48px !important;
            background-size: 24px !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .icon-shape i {
            font-size: 1.5rem !important;
            color: white !important;
        }
        /* Ensure proper icon styling */
        .bg-gradient-primary {
            background: linear-gradient(310deg, #2152ff 0%, #21d4fd 100%) !important;
        }
        .bg-gradient-success {
            background: linear-gradient(310deg, #17ad37 0%, #98ec2d 100%) !important;
        }
        .bg-gradient-warning {
            background: linear-gradient(310deg, #f53939 0%, #fbcf33 100%) !important;
        }
        .bg-gradient-info {
            background: linear-gradient(310deg, #2152ff 0%, #21d4fd 100%) !important;
        }
        .bg-gradient-danger {
            background: linear-gradient(310deg, #ea0606 0%, #ff667c 100%) !important;
        }
        /* Fix icon opacity and sizing */
        .icon-shape .opacity-10 {
            opacity: 1 !important;
        }
        .icon-shape .text-lg {
            font-size: 1.5rem !important;
        }
        /* Ensure proper shadow classes */
        .shadow-primary {
            box-shadow: 0 4px 20px 0 rgba(33, 82, 255, 0.3) !important;
        }
        .shadow-success {
            box-shadow: 0 4px 20px 0 rgba(23, 173, 55, 0.3) !important;
        }
        .shadow-danger {
            box-shadow: 0 4px 20px 0 rgba(234, 6, 6, 0.3) !important;
        }
        .shadow-warning {
            box-shadow: 0 4px 20px 0 rgba(245, 57, 57, 0.3) !important;
        }
        /* Fix table text contrast */
        .table tbody td {
            color: #ffffff !important;
        }
        .table tbody td h6,
        .table tbody td p,
        .table tbody td span {
            color: #ffffff !important;
        }
        /* Fix text-secondary class for better contrast */
        .text-secondary {
            color: #ffffff !important;
        }
        /* Fix View button contrast */
        .table a {
            color: #00ff88 !important;
            text-decoration: none;
        }
        .table a:hover {
            color: #00cc6a !important;
            text-decoration: underline;
        }
        /* Ensure all table text is white */
        .text-xs, .text-sm {
            color: #ffffff !important;
        }
        .icon {
            color: white !important;
        }
        .shadow-primary { box-shadow: 0 4px 20px 0 rgba(0, 123, 255, 0.14) !important; }
        .shadow-success { box-shadow: 0 4px 20px 0 rgba(40, 167, 69, 0.14) !important; }
        .shadow-danger { box-shadow: 0 4px 20px 0 rgba(220, 53, 69, 0.14) !important; }
        .shadow-warning { box-shadow: 0 4px 20px 0 rgba(255, 193, 7, 0.14) !important; }
        .bg-gradient-primary { background-image: linear-gradient(310deg, #7928ca, #ff0080); }
        .bg-gradient-success { background-image: linear-gradient(310deg, #17ad37, #98ec2d); }
        .bg-gradient-danger { background-image: linear-gradient(310deg, #ea0606, #ff667c); }
        .bg-gradient-warning { background-image: linear-gradient(310deg, #f53939, #fbcf33); }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-stethoscope me-2"></i>
                Healthcare Audit Tool
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-arrow-left me-1"></i>
                    Back to Dashboard
                </a>
                {% if session.get('user_name') == 'admin' or session.get('user_team') == 'Administration' %}
                <a class="nav-link" href="/audit-times">
                    <i class="fas fa-clock me-1"></i>
                    Audit Times
                </a>
                {% endif %}
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user me-1"></i>
                        {{ session.get('user_name', 'User') }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><span class="dropdown-item-text text-muted">
                            <i class="fas fa-users me-2"></i>{{ session.get('user_team', 'No Team') }}
                        </span></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <!-- Stats Cards -->
        <div class="row">
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Feedback</p>
                                    <h5 class="font-weight-bolder">{{ stats.total_feedback }}</h5>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                                    <i class="fas fa-list-alt text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Accepted Codes</p>
                                    <h5 class="font-weight-bolder">{{ stats.accepted_codes }}</h5>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                                    <i class="fas fa-check text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Rejected Codes</p>
                                    <h5 class="font-weight-bolder">{{ stats.rejected_codes }}</h5>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                                    <i class="fas fa-times text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Acceptance Rate</p>
                                    <h5 class="font-weight-bolder">{{ stats.acceptance_rate }}%</h5>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                                    <i class="fas fa-percentage text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Stats -->
        <div class="row mt-4">
            <div class="col-lg-7 mb-lg-0 mb-4">
                <div class="card">
                    <div class="card-header pb-0 p-3">
                        <h6 class="mb-0">Feedback Distribution</h6>
                    </div>
                    <div class="card-body p-3">
                        <ul class="list-group">
                            <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                                <div class="d-flex align-items-center">
                                    <div class="icon icon-shape icon-sm me-3 bg-gradient-success shadow-success">
                                        <i class="fas fa-check text-white"></i>
                                    </div>
                                    <div class="d-flex flex-column">
                                        <h6 class="mb-1 text-dark text-sm">Accepted</h6>
                                        <span class="text-xs">{{ stats.accepted_codes }} codes</span>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                                <div class="d-flex align-items-center">
                                    <div class="icon icon-shape icon-sm me-3 bg-gradient-danger shadow-danger">
                                        <i class="fas fa-times text-white"></i>
                                    </div>
                                    <div class="d-flex flex-column">
                                        <h6 class="mb-1 text-dark text-sm">Rejected</h6>
                                        <span class="text-xs">{{ stats.rejected_codes }} codes</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header pb-0 p-3">
                        <h6 class="mb-0">Recent Activity</h6>
                    </div>
                    <div class="card-body p-3">
                        <ul class="list-group">
                            <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-white font-weight-bold text-sm">Latest Feedback:</h6>
                                    <span class="text-xs text-white">{{ stats.latest_feedback_timestamp }}</span>
                                </div>
                            </li>
                            <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-white font-weight-bold text-sm">Total Accounts Reviewed:</h6>
                                    <span class="text-xs text-white">{{ stats.total_accounts_reviewed }}</span>
                                </div>
                            </li>
                            <li class="list-group-item border-0 d-flex justify-content-between ps-0 border-radius-lg">
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-white font-weight-bold text-sm">Average Response Time:</h6>
                                    <span class="text-xs text-white">{{ stats.average_response_time }}</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Submitted Feedback Table -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header pb-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6>All Submitted Feedback</h6>
                            <button class="btn btn-success btn-sm" onclick="downloadExcel()">
                                <i class="fas fa-download me-2"></i>
                                Download Excel
                            </button>
                        </div>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        {% if all_feedback %}
                        <div class="table-responsive p-0">
                            <table class="table table-hover align-items-center mb-0">
                                <thead>
                                    <tr>
                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Account</th>
                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">ICD Code</th>
                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Feedback</th>
                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Type</th>
                                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">CC/MCC</th>
                                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Decision</th>
                                        <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Reviewer</th>
                                        <th class="text-secondary opacity-7"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for feedback in all_feedback %}
                                    <tr>
                                        <td>
                                            <div class="d-flex px-2 py-1">
                                                <div class="d-flex flex-column justify-content-center">
                                                    <h6 class="mb-0 text-sm text-white">{{ feedback.account_number }}</h6>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <p class="text-xs font-weight-bold mb-0 text-white">{{ feedback.icd_code }}</p>
                                        </td>
                                        <td>
                                            <p class="text-xs font-weight-bold mb-0 text-white">{{ feedback.feedback | default('-', true) }}</p>
                                        </td>
                                        <td>
                                            <p class="text-xs font-weight-bold mb-0 text-white">{{ feedback.type | default('-', true) }}</p>
                                        </td>
                                        <td>
                                            <p class="text-xs font-weight-bold mb-0 text-white">
                                                {% if feedback.cc_mcc and feedback.cc_mcc != 'nan' and feedback.cc_mcc != '' %}
                                                    <span class="badge badge-sm bg-gradient-warning">{{ feedback.cc_mcc }}</span>
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </p>
                                        </td>
                                        <td class="align-middle text-center text-sm">
                                            <span class="badge badge-sm bg-gradient-{{ 'success' if feedback.decision == 'accept' else 'danger' }}">{{ feedback.decision }}</span>
                                        </td>
                                        <td class="align-middle text-center">
                                            <span class="text-white text-xs font-weight-bold">{{ feedback.reviewer }}</span>
                                        </td>
                                        <td class="align-middle">
                                            <a href="{{ url_for('account_history', account_id=feedback.account_number) }}" class="text-success font-weight-bold text-xs" data-toggle="tooltip" data-original-title="View Details">
                                                View
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No feedback submitted yet</h5>
                            <p>Start reviewing accounts to see feedback here</p>
                            <a href="/" class="btn btn-primary mt-3">
                                <i class="fas fa-arrow-left me-2"></i>
                                Go to Dashboard
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function downloadExcel() {
        // Show loading state
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Downloading...';
        button.disabled = true;
        
        // Download the file
        window.location.href = '/validation/download_excel';
        
        // Reset button after a delay
        setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
        }, 3000);
    }
</script>
</body>
</html> 